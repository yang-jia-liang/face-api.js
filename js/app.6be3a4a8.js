(function(){var e={7405:function(e,a,t){"use strict";t(6992),t(8674),t(7727);var o=t(9242),n=t(3396);const i={id:"app"};function r(e,a,t,o,r,s){const l=(0,n.up)("FaceRecognize");return(0,n.wg)(),(0,n.iD)("div",i,[(0,n.Wm)(l)])}var s=t(4648),l=(t(3948),t(6699),t(5827),t(4870)),c=t(7139),d=t.p+"media/shylock.449e5e04.mp4",u=t.p+"img/卷福.fe160b7d.jpg",m=t.p+"img/华生.92ff5fde.png",f=t(166),p=t(9733);const v=e=>((0,n.dD)("data-v-2949188d"),e=e(),(0,n.Cn)(),e),w={class:"detectBox"},h=["src"],g=v((()=>(0,n._)("source",{src:d,type:"video/mp4"},null,-1))),k=(0,n.Uk)(" 抱歉，您的浏览器不支持嵌入式视频。 "),y=[g,k],b={class:"timer"},_={class:"faceCompare"},F=v((()=>(0,n._)("h2",null,"已录入人脸",-1))),x=v((()=>(0,n._)("div",{class:"referenceImgs"},[(0,n._)("p",null,[(0,n._)("img",{src:u,alt:"夏洛克·福尔摩斯"}),(0,n._)("span",null,"夏洛克·福尔摩斯")]),(0,n._)("p",null,[(0,n._)("img",{src:m,alt:"约翰·H·华生"}),(0,n._)("span",null,"约翰·H·华生")])],-1))),C=[F,x],L={class:"similarity"},V=v((()=>(0,n._)("h2",null,"相似度比较",-1))),T={class:"referenceImgs"},S=v((()=>(0,n._)("p",null,[(0,n._)("img",{src:u,alt:"夏洛克·福尔摩斯",id:"reference"}),(0,n._)("span",null,"夏洛克·福尔摩斯")],-1))),U=["src"],D=v((()=>(0,n._)("span",null,"相似度：",-1))),P=(0,n.Uk)("人脸识别"),W=(0,n.Uk)("表情"),O=(0,n.Uk)("年龄性别"),I=(0,n.Uk)("显示人脸边界"),q=(0,n.Uk)("显示人脸标记点"),B={class:"bottomBox"},j=(0,n.Uk)(" 人脸相似度比较 "),M=(0,n.Uk)(" 视频人脸追踪 "),z=(0,n.Uk)(" 摄像头人脸追踪 "),A=(0,n.Uk)(" 选择图片 "),E=(0,n.Uk)(" 配置 ");var $={__name:"index",setup(e){const a=(0,l.qj)({base64:"",similarity:0,detectList:[],optionList:[],showSimilar:!1,trackVideoFaces:!1,trackCameraFaces:!1,videoStream:"",videoStatus:0,genderTranslator:{male:"男",female:"女"},expressionTranslator:{neutral:"正常",happy:"开心",sad:"伤心",angry:"生气",fearful:"害怕",disgusted:"恶心",surprised:"惊喜"},detectTypes:["AgeAndGender","Expression","Face"],faces:[],showConfig:!1,columns:[{values:[{text:"SSD",value:"SSD"},{text:"Tiny",value:"Tiny"}],defaultIndex:1},{values:[{text:"0.1",value:.1},{text:"0.2",value:.2},{text:"0.3",value:.3},{text:"0.4",value:.4},{text:"0.5",value:.5},{text:"0.6",value:.6},{text:"0.7",value:.7},{text:"0.8",value:.8},{text:"0.9",value:.9}],defaultIndex:4},{values:[{text:"128",value:128},{text:"160",value:160},{text:"224",value:224},{text:"320",value:320},{text:"416",value:416},{text:"512",value:512},{text:"608",value:608}],defaultIndex:3}],selectedValue:["Tiny",.5,320],showCameraList:!1,cameraList:[],videoTrack:null,count:0,forwardTimes:[],time:"",fps:""}),t=(0,l.qj)({canvas:null,img:null,video:null,pickImage:null}),{canvas:i,img:r,video:d,pickImage:u}=(0,l.BK)(t),m=async e=>{const t=e.target.files,o=await f.dV(t[0]);a.base64=o.src},v=async()=>{const e=document.querySelectorAll(".faceCompare img");for(const t of e){const e=await f.bd(t).withFaceLandmarks().withFaceDescriptor();a.faces=[...a.faces,new f.oE(t.alt,[e.descriptor])]}},g=(e,a)=>{const t={x:50,y:50,width:100,height:100},o={label:"Hello I am a box!",lineWidth:2,boxColor:"red",drawLabelOptions:{anchorPosition:"TOP_LEFT",backgroundColor:"rgba(0, 0, 0, 0.5)",fontColor:"purple",fontSize:16,padding:15}},n=new f.ii.DrawBox(e||t,a||o);n.draw(i.value)},k=(e,a,t)=>{const o=["This is a textline!","This is another textline!"],n={x:200,y:200},r={},s=new f.ii.DrawTextField(e||o,a||n,t||r);s.draw(i.value)},F=async()=>{const{detectList:e,optionList:t,faces:o,base64:n,trackVideoFaces:s,trackCameraFaces:l,videoStatus:c}=a,u=s||l?"myVideo":"myImg",m=Date.now();if("myImg"===u&&!n||"myVideo"===u&&!c)return;let p;p="myImg"===u?{width:r.value.width,height:r.value.height}:f.JF(i.value,d.value,!0),f.JF(i.value,p);const v=Z();if(e.includes("Recognition")){const e=await f.Qr(u,v).withFaceLandmarks().withFaceDescriptors(),a=f._C(e,p),t=new f.zi(o||[]);a.forEach((e=>{const{descriptor:a,detection:{box:o}}=e,n=t.findBestMatch(a);g(o,{label:n._label})}))}if(e.includes("Expression")){const e=await f.Qr(u,v).withFaceLandmarks().withFaceExpressions(),t=f._C(e,p);t.forEach((e=>{const{expressions:t}=e,o=Math.max(...Object.values(t)),n=Object.entries(t).find((([,e])=>e===o))[0];k([`${a.expressionTranslator[n]} (${Math.round(100*f.P6.round(o))}%)`],e.detection.box.bottomLeft)}))}if(e.includes("AgeAndGender")){const e=await f.Qr(u,v).withFaceLandmarks().withAgeAndGender(),t=f._C(e,p);t.forEach((e=>{const{age:t,gender:o,genderProbability:n}=e;k([`${a.genderTranslator[o]} (${100*f.P6.round(n)}%)`,`${f.P6.round(t,0)} 岁 `],e.detection.box.bottomLeft)}))}if(t.includes("showBorder")){const e=await f.Qr(u,v),a=f._C(e,p);a.forEach((e=>{const{box:a,_score:t}=e;g(a,{label:`可信度${Math.round(100*t)}%`})}))}if(t.includes("showMark")){const e=await f.Qr(u,v).withFaceLandmarks(),a=f._C(e,p);f.ii.drawFaceLandmarks(i.value,a)}c&&($(Date.now()-m),setTimeout((()=>{window.requestAnimationFrame(F)})))},x=async()=>{const e=await f.bd("reference").withFaceLandmarks().withFaceDescriptor(),t=await f.bd("toCompare").withFaceLandmarks().withFaceDescriptor();a.similarity=e&&t?Math.round(100*f.P6.round(1-f.WI(e.descriptor,t.descriptor))):0},$=e=>{a.forwardTimes=[e].concat(a.forwardTimes).slice(0,30);const t=a.forwardTimes.reduce(((e,a)=>e+a))/a.forwardTimes.length;a.time=`${Math.round(t)} ms`,a.fps=`${f.P6.round(1e3/t)}`},Z=()=>{const{selectedValue:e}=a;return"SSD"===e[0]?new f.d7({minConfidence:e[1]}):new f.aK({scoreThreshold:e[1],inputSize:e[2]})},R=(e,t)=>{0===t&&(a.columns[2].values="SSD"===e[0].value?a.columns[2].values.map((e=>(0,s.Z)((0,s.Z)({},e),{},{disabled:!0}))):a.columns[2].values.map((e=>(0,s.Z)((0,s.Z)({},e),{},{disabled:!1}))))},G=e=>{const{trackVideoFaces:t,trackCameraFaces:o}=a;a.selectedValue=e.map((e=>e.value)),a.showConfig=!1,t||o||F()},N=()=>{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((e=>{const t=e.filter((e=>"videoinput"===e.kind)).map(((e,a)=>({text:e.label||`摄像头${a+1}`,value:e.deviceId})));t.length?(a.showCameraList=!0,a.cameraList=t):p.F.fail({message:"未找到网络摄像头",forbidClick:!0,mask:!0})})).catch((e=>{console.log(e)})):p.F.fail({message:"不支持 enumerateDevices()",forbidClick:!0,mask:!0})},Q=e=>{a.showCameraList=!1,navigator.mediaDevices.getUserMedia({audio:!1,video:{sourceId:e[0]}}).then((function(e){d.value.srcObject=e,a.videoTrack=e.getTracks()[0],window.requestAnimationFrame(F)})).catch((function(){p.F.fail({message:"摄像头调用失败",forbidClick:!0,mask:!0})}))},H=()=>{const e=p.F.loading({duration:0,message:"模型加载中...",forbidClick:!0,mask:!0});Promise.all([f.qB.faceRecognitionNet.loadFromUri("./models"),f.qB.faceLandmark68Net.loadFromUri("./models"),f.qB.faceLandmark68TinyNet.loadFromUri("./models"),f.qB.ssdMobilenetv1.loadFromUri("./models"),f.qB.tinyFaceDetector.loadFromUri("./models"),f.qB.mtcnn.loadFromUri("./models"),f.qB.faceExpressionNet.loadFromUri("./models"),f.qB.ageGenderNet.loadFromUri("./models")]).then((()=>{v(),e.clear()})).catch((()=>{e.clear()}))};return(0,n.bv)((()=>{H()})),(0,n.YP)((()=>a.trackCameraFaces),(e=>{var t;e?N():null===(t=a.videoTrack)||void 0===t||t.stop()})),(e,t)=>{const s=(0,n.up)("van-checkbox"),f=(0,n.up)("van-checkbox-group"),p=(0,n.up)("van-switch"),v=(0,n.up)("van-button"),g=(0,n.up)("van-picker"),k=(0,n.up)("van-popup");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("input",{hidden:"",type:"file",onChange:m,accept:"image/*",ref_key:"pickImage",ref:u},null,544),(0,n._)("div",w,[(0,n.wy)((0,n._)("img",{src:a.base64,alt:"",width:"500",ref_key:"img",ref:r,id:"myImg",onLoad:F},null,40,h),[[o.F8,!a.trackVideoFaces&&!a.trackCameraFaces]]),a.trackVideoFaces?((0,n.wg)(),(0,n.iD)("video",{key:0,width:"500",ref_key:"video",ref:d,id:"myVideo",muted:"",playsinline:"",preload:"",loop:"",onDurationchange:t[0]||(t[0]=e=>(0,l.SU)(d).play()),onPlay:t[1]||(t[1]=e=>a.videoStatus=1),onPause:t[2]||(t[2]=e=>a.videoStatus=0)},y,544)):(0,n.kq)("",!0),a.trackCameraFaces?((0,n.wg)(),(0,n.iD)("video",{key:1,ref_key:"video",ref:d,id:"myVideo",autoplay:"",muted:"",playsinline:"",onPlay:t[3]||(t[3]=e=>a.videoStatus=1),onPause:t[4]||(t[4]=e=>a.videoStatus=0)},null,544)):(0,n.kq)("",!0),(0,n._)("canvas",{ref_key:"canvas",ref:i},null,512)]),(0,n.wy)((0,n._)("section",b,[(0,n._)("p",null,"平均检测时长："+(0,c.zw)(a.time),1),(0,n._)("p",null,"fps："+(0,c.zw)(a.fps>200?"200+":a.fps),1)],512),[[o.F8,a.trackVideoFaces||a.trackCameraFaces]]),(0,n.Uk)(" "+(0,c.zw)(a.videoTrack),1),(0,n.wy)((0,n._)("section",_,C,512),[[o.F8,a.detectList.includes("Recognition")]]),(0,n.wy)((0,n._)("section",L,[V,(0,n._)("div",T,[S,(0,n._)("p",null,[(0,n._)("img",{src:a.base64,alt:"",id:"toCompare",onLoad:x},null,40,U),D,(0,n._)("span",{class:(0,c.C_)({danger:a.similarity<50})},(0,c.zw)(a.similarity)+"%",3)])])],512),[[o.F8,a.showSimilar]]),(0,n.Wm)(f,{modelValue:a.detectList,"onUpdate:modelValue":t[5]||(t[5]=e=>a.detectList=e),onChange:F},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{name:"Recognition"},{default:(0,n.w5)((()=>[P])),_:1}),(0,n.Wm)(s,{name:"Expression"},{default:(0,n.w5)((()=>[W])),_:1}),(0,n.Wm)(s,{name:"AgeAndGender"},{default:(0,n.w5)((()=>[O])),_:1})])),_:1},8,["modelValue"]),(0,n.Wm)(f,{modelValue:a.optionList,"onUpdate:modelValue":t[6]||(t[6]=e=>a.optionList=e),onChange:F},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{name:"showBorder"},{default:(0,n.w5)((()=>[I])),_:1}),(0,n.Wm)(s,{name:"showMark"},{default:(0,n.w5)((()=>[q])),_:1})])),_:1},8,["modelValue"]),(0,n._)("div",B,[(0,n._)("p",null,[(0,n.Wm)(p,{modelValue:a.showSimilar,"onUpdate:modelValue":t[7]||(t[7]=e=>a.showSimilar=e),size:"24"},null,8,["modelValue"]),j]),(0,n._)("p",null,[(0,n.Wm)(p,{modelValue:a.trackVideoFaces,"onUpdate:modelValue":t[8]||(t[8]=e=>a.trackVideoFaces=e),disabled:a.trackCameraFaces,size:"24"},null,8,["modelValue","disabled"]),M]),(0,n._)("p",null,[(0,n.Wm)(p,{modelValue:a.trackCameraFaces,"onUpdate:modelValue":t[9]||(t[9]=e=>a.trackCameraFaces=e),disabled:a.trackVideoFaces,size:"24"},null,8,["modelValue","disabled"]),z])]),(0,n.Wm)(v,{plain:"",type:"primary",onClick:t[10]||(t[10]=e=>(0,l.SU)(u).click())},{default:(0,n.w5)((()=>[A])),_:1}),(0,n.Wm)(v,{plain:"",type:"primary",onClick:t[11]||(t[11]=e=>a.showConfig=!0)},{default:(0,n.w5)((()=>[E])),_:1}),(0,n.Wm)(k,{show:a.showCameraList,position:"bottom",round:"","close-on-click-overlay":!1},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{title:"摄像头列表",columns:a.cameraList,onConfirm:Q,onCancel:t[12]||(t[12]=e=>{a.showCameraList=!1,a.trackCameraFaces=!1})},null,8,["columns"])])),_:1},8,["show"]),(0,n.Wm)(k,{show:a.showConfig,position:"bottom",round:"","close-on-click-overlay":!1},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{title:"人脸检测器配置",columns:a.columns,onConfirm:G,onCancel:t[13]||(t[13]=e=>a.showConfig=!1),onChange:R},null,8,["columns"])])),_:1},8,["show"])])}}},Z=t(89);const R=(0,Z.Z)($,[["__scopeId","data-v-2949188d"]]);var G=R,N={name:"App",components:{FaceRecognize:G}};const Q=(0,Z.Z)(N,[["render",r]]);var H=Q,J=t(7966);t(5110);(0,o.ri)(H).use(J.ZP).mount("#app")},4902:function(){},522:function(){},753:function(){}},a={};function t(o){var n=a[o];if(void 0!==n)return n.exports;var i=a[o]={exports:{}};return e[o](i,i.exports,t),i.exports}t.m=e,function(){var e=[];t.O=function(a,o,n,i){if(!o){var r=1/0;for(d=0;d<e.length;d++){o=e[d][0],n=e[d][1],i=e[d][2];for(var s=!0,l=0;l<o.length;l++)(!1&i||r>=i)&&Object.keys(t.O).every((function(e){return t.O[e](o[l])}))?o.splice(l--,1):(s=!1,i<r&&(r=i));if(s){e.splice(d--,1);var c=n();void 0!==c&&(a=c)}}return a}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[o,n,i]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p=""}(),function(){var e={143:0};t.O.j=function(a){return 0===e[a]};var a=function(a,o){var n,i,r=o[0],s=o[1],l=o[2],c=0;if(r.some((function(a){return 0!==e[a]}))){for(n in s)t.o(s,n)&&(t.m[n]=s[n]);if(l)var d=l(t)}for(a&&a(o);c<r.length;c++)i=r[c],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(d)},o=self["webpackChunkface_api"]=self["webpackChunkface_api"]||[];o.forEach(a.bind(null,0)),o.push=a.bind(null,o.push.bind(o))}();var o=t.O(void 0,[998],(function(){return t(7405)}));o=t.O(o)})();
//# sourceMappingURL=app.6be3a4a8.js.map